# npm

##  javascript 包管理的历史
- npm 出现之前：前端依赖项是保存到存储库中并手动下载的📁
- 2010：npm 发布并支持 nodejs📦
- 2012：npm 的使用量急剧增加——主要是由于 Browserifys 浏览器的支持🎉
- 2012：npm 有了一个竞争对手 bower，它完全支持浏览器💻
- 2012-2016：前端项目的依赖项数量成倍增加🤯
- 2012-2016：构建和安装前端应用变得越来越慢🐢
- 2012-2016：大量（重复的）依赖项存储在神奇的 node_modules 内的嵌套文件夹中☢️
- 2012-2016：rm -rf node_modules 成为前端开发人员最常用的命令。 🗑
- 2015：bower 输给了 npm  💀
- 2015：node_modules 被修改为扁平化的文件结构！ 🕸
- 2016： left-pad成为当时的新闻头条 👈
- 2016： yarn 发布 🚀
  - 支持 npm 和 bower 仓库
  - yarn.lock 能够锁定安装的版本并提供确定性的依赖关系。不再 rm -rf - node_modules！
  - yarn install 花费的时间是 npm install 的一半（不使用缓存的前提下）
  - 缓存和脱机模式使构建过程几乎不花费时间
- 2016：npm 发布 shrinkwrap🧯
  - 尝试处理依赖项锁定
  - 不幸的是，一些错误和超出其管理能力的承诺导致该工具的声誉下降
- 2017：npm 5 发布🔓
  - package-lock.json 是他们的新工具，shrinkwrap 被放在一边
  - package-lock.json 开始与 yarns 锁定文件竞争


- 2018：npm ci 发布🛬
  - 直接用 package-lock.json 构建代码
  - 没有代价高昂的依赖项安全性分析和版本分析
  - 大大减少了在构建服务器上的构建时间！
- 2018：npm 6 发布👮‍♀️
  - npm 检查要安装的依赖项中的安全漏洞
  - yarn 和 npm 的构建时间不再有显差异
- 2019：tink 开始进入 beta 模式🦋
  - 避免使用 node_modules，而是为项目中的每个依赖项创建一个带有哈希值的文件
  - 尚未做好投入生产环境的准备
- ...

## 早期的npm

其实在最早期的`npm`版本(npm v2)，`npm`的设计可以说是非常的简单,在安装依赖的时候会将依赖放到` node_modules`文件中; 同时,如果某个直接依赖A依赖于其他的依赖包B,那么依赖B会作为间接依赖,安装到依赖A的文件夹`node_modules`中,然后可能多个包之间也会有出现同样的依赖递归的,如果项目一旦过大,那么必然会形成一棵巨大的依赖树，依赖包会出现重复,形成`嵌套地狱`。

### 那么我们如何去理解"嵌套地狱"呢？
- 首先,项目的依赖树的层级过于深，如果有问题不利于排查和调试
- 在依赖的分支中,可能会出现同样版本的相互依赖的问题

### 那么这样的重复问题会带来什么后果呢？
- 首先,会使得安装的结果占据了大量的空间资源,造成了资源的浪费
- 同时,因为安装的依赖重复,会造成在安装依赖时,安装时间过长
- 甚至是,因为目录层级过深,导致文件路径过长,会在`windows`系统下删除`node_modules`文件,出现删除不掉的情况

### 你在实际的开发会不会出现这样的一些情况
当你项目依赖出现问题的时候, 我们会不会是直接删除`node_modules` 和 `lockfiles`依赖, 再重新 `npm install`,删除大法是否真的好用?这样的使用方案会不会带来什么问题？

把所有的依赖包都安装到`dependencies`中,对`devDependencies` 不区分会不会有问题?

一个项目中, 你使用 `yarn`, 我使用`npm`，会不会有问题呢？

还有一个问题, `lockfiles 文件` 我们提交代码的时候需不需要提交到仓库中呢？

## 目标

```
给你和你的团队、你的公司带来最好的开源库和依赖。
通过这句话,我们可以了解到 npm 最重要的一点就是安装和维护依赖。
```

## 安装机制

![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4fbc0e4e27c14500a2a9e4fcf4757fae~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp?)



`npm install`执行之后, 首先会检查和获取 `npm的配置`,这里的优先级为:

```
项目级的.npmrc文件 > 用户级的 .npmrc文件 > 全局级的 .npmrc > npm内置的 .npmrc 文件
```

## 参考资料

- [npm-官网](https://www.npmjs.com/)

- [npm-掘金](https://juejin.cn/post/6844903870578032647)

- [npm 和 yarn 你选哪个？](https://juejin.cn/post/6844904030741921800)